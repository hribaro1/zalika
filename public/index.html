<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Laundry Service</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, select { display:block; margin:8px 0; padding:8px; width:300px; max-width:100%; }
    #orders { margin-top: 24px; }
    .order { border:1px solid #ddd; padding:10px; margin-bottom:8px; border-radius:4px; }
    .meta { color:#666; font-size:12px; }

    /* Button styling: bigger and blue */
    #placeOrder {
      background: #007bff;
      color: #fff;
      padding: 12px 24px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
      transition: background 0.15s ease, transform 0.08s ease;
    }
    #placeOrder:hover { background: #0062cc; transform: translateY(-1px); }
    #placeOrder:active { transform: translateY(0); }
    #placeOrder:focus { outline: 3px solid rgba(0,123,255,0.25); }
  </style>
</head>
<body>
  <h1>Laundry Booking</h1>

  <input id="name" placeholder="Your Name" />
  <input id="email" placeholder="Your Email" />
  <input id="address" placeholder="Your Address" />
  
  <select id="service">
    <option>Dry Cleaning</option>
    <option>Wash & Fold</option>
    <option>Ironing</option>
  </select>

  <button id="placeOrder">Place Order</button>

  <div id="orders">
    <h2>Pregled naročil</h2>
    <div id="ordersList">Nalaganje...</div>
  </div>

  <script>
    function isValidEmail(email) {
      return /.+@.+\..+/.test(email);
    }

    async function loadOrders() {
      const list = document.getElementById('ordersList');
      list.textContent = 'Nalaganje...';
      try {
        const res = await fetch('/orders');
        if (!res.ok) throw new Error('Network response not ok');
        const orders = await res.json();
        if (!orders.length) {
          list.innerHTML = '<i>Ni še nobenih naročil.</i>';
          return;
        }
        list.innerHTML = '';
        orders.forEach(o => {
          const div = document.createElement('div');
          div.className = 'order';
          const created = o.createdAt ? new Date(o.createdAt).toLocaleString() : '';
          div.innerHTML = `
            <strong>${escapeHtml(o.name)}</strong> — ${escapeHtml(o.service)}<br/>
            <div class="meta">${escapeHtml(o.email)} • ${escapeHtml(o.address)}${created ? ' • ' + created : ''}</div>
            <div class="meta">Status: ${escapeHtml(o.status || 'Pending')}</div>
          `;
          list.appendChild(div);
        });
      } catch (err) {
        console.error(err);
        list.innerHTML = '<span style="color:red">Napaka pri nalaganju naročil.</span>';
      }
    }

    function escapeHtml(str) {
      if (!str && str !== 0) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    async function order() {
      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email").value.trim();
      const address = document.getElementById("address").value.trim();
      const service = document.getElementById("service").value;

      if (!name) return alert("Please enter your name.");
      if (!email || !isValidEmail(email)) return alert("Please enter a valid email address.");
      if (!address) return alert("Please enter your address.");

      try {
        const res = await fetch("/order", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, email, address, service })
        });
        if (!res.ok) {
          const err = await res.json().catch(() => null);
          throw new Error(err && err.error ? err.error : 'Server error');
        }
        const data = await res.json();
        alert(data.message || "Order placed!");
        // Clear inputs
        document.getElementById("name").value = '';
        document.getElementById("email").value = '';
        document.getElementById("address").value = '';
        // Refresh list
        loadOrders();
      } catch (err) {
        console.error(err);
        alert("Failed to place order. See console for details.");
      }
    }

    document.getElementById("placeOrder").addEventListener("click", order);

    // Initial load
    loadOrders();
  </script>
</body>
</html>

